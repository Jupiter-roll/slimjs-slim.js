<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>slim.js - TodoExample</title>

    <script>
        var isChrome;
        try {
            isChrome = typeof window.chrome.webstore === 'object'
        }
        catch (err) {
            isChrome = false;
        }
        if (!isChrome) {
            let s = "<script type=\"text\/javascript\" " +
                    "src=\"https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.23/webcomponents.min.js\"" +
                    " > <\/script> "
            document.write(s)
        }
    </script>
    <link href="https://fonts.googleapis.com/css?family=Libre+Baskerville|Nixie+One|Ubuntu+Mono" rel="stylesheet">

    <script src="../../Slim.js"></script>

    <style>
    todo-item span[complete="true"] {
        text-decoration: line-through;
    }
    </style>
</head>
<body>

    <h1>Todo Example</h1>
    <todo-app></todo-app>

<script>

    class Todo {
        constructor(text) {
            this.text = text;
            this.complete = false;
        }

        setComplete(value) {
            this.complete = !!value
        }
    }

    Slim.tag('todo-item', class extends Slim {
        get template() {
            return `<div class="todo-item"><input slim-id="complete" type="checkbox"/><span complete=[[data.complete]] class="todo-text" bind>[[data.text]]</span></div>`
        }

        onAfterRender() {
            this.complete.onchange = () => {
                this.data.setComplete(this.complete.checked)
                this.update()
            }
        }

    })

    Slim.tag('todo-app', class extends Slim {


        get template() {
            return `<div id="todo-container">
                    <input type="text" slim-id="newTodo" /><input type="button" slim-id="btnNewTodo" value="Add Todo" />
                    <hr/>
                    <todo-item slim-repeat="todos"></todo-item>
                    <hr/>
                    <div id="todos-count"><span bind>You have [[todos.length]] items</span><input type="button" slim-id="btnClear" value="Clear completed"></input></div>
                    `
        }

        onBeforeCreated() {
            this.todos = [
                new Todo('Get slim.js'),
                new Todo('Quickly start writing web components')
            ]
        }

        addTodo(value) {
            this.todos.push( new Todo(value) )
            this.newTodo.value = ''
            this.update()
            this.newTodo.focus()
        }

        onCreated() {
            this.btnClear.onclick = () => {
                this.todos = this.todos.filter( todo => {
                    return todo.complete === false
                })
            }
            this.btnNewTodo.onclick = () => {
                this.checkAndAddTodo()
            }
            this.newTodo.onkeyup = (e) => {
                if (e.which === 13) {
                    this.checkAndAddTodo()
                }
            }
        }

        checkAndAddTodo() {
            if (this.newTodo.value !== '') {
                this.addTodo( this.newTodo.value)
            }
        }
    })

</script>
</body>
</html>