<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        var isChrome;
        try {
            isChrome = typeof window.chrome.webstore === 'object'
        }
        catch (err) {
            isChrome = false;
        }
        if (!isChrome) {
            let s = "<script type=\"text\/javascript\" " +
                    "src=\"https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.23/webcomponents.min.js\"" +
                    " > <\/script> "
            document.write(s)
        }
    </script>
    <script src="../../Slim.js"></script>
</head>
<body>

<todo-list></todo-list>

<style>
    todo-item {
        cursor: pointer;
    }

    todo-item .done {
        text-decoration: line-through;
    }

    todo-list ul {
        list-style-type: none;
    }
</style>

<script>
    Slim.tag('todo-item', class extends Slim {
        get template() {
            return `<span class="[[getDoneClass(todo)]]" bind>[[todo.text]]</span>`;
        }

        get isInteractive() { return true;}

        getDoneClass(todo) {
            if (todo.done) return 'done'
            return ''
        }
    });

    Slim.tag('todo-list', class extends Slim {
        get template() {
            return `<div>
                        <input input="handleInput" type="text" #new_todo /><input type="button" click="addTodo" value="Add" #add_todo />
                    </div>
                    <div>
                        <ul>
                            <li slim-repeat="todos" slim-repeat-as="todo">
                                <todo-item click="toggle"></todo-item>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <input type="button" value="Clear completed" #clear/>
                    </div>`
        }

        handleInput(e) { console.log(e); }

        toggle(event) {
            event.currentTarget.todo.done = !event.currentTarget.todo.done;
        }

        addTodo() {
            this.todos.push({text: this.new_todo.value});
            this.new_todo.value = '';
        }

        onAfterRender() {
            this.clear.onclick = () => {
                this.todos = this.todos.filter( todo => { return !todo.done })
            }
        }

        onCreated() {
            this.todos = [
                { text: 'Install slim.js' },
                { text: 'Build applications and enjoy it'}
            ];
        }
    });
</script>
</body>
</html>