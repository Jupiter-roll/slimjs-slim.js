<script>

    (function(window) {
        'use strict'

        class SlimElement extends HTMLElement {

            get _renderOnAttributes() {
                return ['layout']
            }

            constructor(attributes) {
                super()
                if (attributes !== undefined) {
                    for (let key of attributes) {
                        if (key.indexOf('_') !== 0) this.setAttribute(key, attributes[key])
                    }
                }
            }

            find(selector) {
                return this.querySelector(selector)
            }

            _onCreated() {}
            _onAttributeChanged() {}
            _onAdded() {}
            _onRemoved() {}
            _render() {}

            _onAppendChild() {
                this._render()
            }
            _onInsertAdjacentElement() {
                this._render()
            }
            _onInsertAdjacentHTML() {
                this._render()
            }
            _onInsertBefore() {
                this._render()
            }
            _onNormalize() {
                this._render()
            }

            //noinspection JSUnusedGlobalSymbols
            setAttbiute(attribute, value) {
                super.setAttribute(attribute, value)
                if (value !== this.getAttribute(attribute)) {
                    this.dispatchEvent(new Event('change'))
                }
            }

            //noinspection JSUnusedGlobalSymbols
            removeChild() {
                super.removeChild.apply(this, arguments)
                this._onRemoveChild(arguments)
            }

            //noinspection JSUnusedGlobalSymbols
            replaceChild() {
                super.replaceChild.apply(this, arguments)
                this._onReplaceChild(arguments)
            }

            //noinspection JSUnusedGlobalSymbols
            normalize() {
                super.normalize.apply(this, arguments)
                this._onNormalize(arguments)
            }

            //noinspection JSUnusedGlobalSymbols
            insertBefore() {
                super.insertBefore.apply(this, arguments)
                this._onInsertBefore(arguments)
            }

            //noinspection JSUnusedGlobalSymbols
            insertAdjacentElement() {
                super.insertAdjacentElement.apply(this, arguments)
                this._onInsertAdjacentElement(arguments)
            }

            //noinspection JSUnusedGlobalSymbols
            insertAdjacentHTML() {
                super.insertAdjacentHTML.apply(this, arguments)
                this._onInsertAdjacentHTML(arguments)
            }

            //noinspection JSUnusedGlobalSymbols
            appendChild() {
                super.appendChild.apply(this, arguments)
                this._onAppendChild(arguments)
            }

            //noinspection JSUnusedGlobalSymbols
            createdCallback() {
                this._onCreated()
            }

            //noinspection JSUnusedGlobalSymbols
            attachedCallback() {
                this._onAdded()
            }

            //noinspection JSUnusedGlobalSymbols
            detachedCallback() {
                this._onRemoved()
            }

            //noinspection JSUnusedGlobalSymbols
            attributeChangedCallback(attribute, oldValue, newValue) {
                if (this._renderOnAttributes.indexOf(attribute) >= 0) {
                    this._render()
                }
                this._onAttributeChanged(attribute, oldValue, newValue)
            }


        }

        window.SlimElement = SlimElement
    }(window))

</script>